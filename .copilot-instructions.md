# GitHub Copilot Instructions for Holiday Calendar Project

## Project Overview

**Holiday Calendar** is a React + TypeScript web application that displays public holidays across multiple European countries. 
It features an interactive calendar with month/year navigation, country filtering, push notifications, and custom event support.

### Tech Stack
- **Frontend Framework**: React 18 with TypeScript (ES2020)
- **Build Tools**: Vite, esbuild
- **Styling**: CSS Modules with modern design
- **Testing**: Jest with React Testing Library
- **Code Quality**: ESLint with TypeScript support
- **Service Worker**: Browser push notifications
- **Date Management**: Intl API with custom UTC date handling
- **Deployment**: SPA with base path `/PublicHolidays/`

## Architecture & Structure

### Directory Layout

```
src/
â”œâ”€â”€ components/          # Reusable React components (each has .tsx + .module.css)
â”‚   â”œâ”€â”€ CalendarDay/     # Single calendar cell
â”‚   â”œâ”€â”€ CalendarGrid/    # Month view calendar grid
â”‚   â”œâ”€â”€ Controls/        # Calendar navigation controls
â”‚   â”œâ”€â”€ CountryFilter/   # Country selection UI
â”‚   â”œâ”€â”€ EventListInput/  # Form for adding custom events
â”‚   â”œâ”€â”€ EventPopup/      # Modal for holiday details
â”‚   â”œâ”€â”€ EventsList/      # List view of events
â”‚   â””â”€â”€ MonthNavigation/ # Month/year selector
â”œâ”€â”€ hooks/               # Custom React hooks
â”‚   â””â”€â”€ useCalendar.ts   # Main calendar state & logic
â”œâ”€â”€ utils/               # Helper functions
â”‚   â”œâ”€â”€ dateUtils.ts     # Date calculations
â”‚   â”œâ”€â”€ UTCDate.ts       # Custom UTC date wrapper
â”‚   â”œâ”€â”€ countryFlags.ts  # Flag emoji mapping
â”‚   â”œâ”€â”€ generateICS.ts   # Calendar file export
â”‚   â””â”€â”€ convertEvents.ts # Event data transformations
â”œâ”€â”€ data/                # Holiday data
â”‚   â”œâ”€â”€ countryNames.ts  # Country codes & names
â”‚   â””â”€â”€ holidays/        # Per-country holiday definitions
â”œâ”€â”€ notifications/       # Push notification system
â”‚   â”œâ”€â”€ types.ts         # Notification types & commands
â”‚   â””â”€â”€ notifications.ts # Notification API
â”œâ”€â”€ assets/              # Static assets
â”‚   â”œâ”€â”€ SW.ts            # Service Worker source (compiled to SW.js)
â”‚   â””â”€â”€ 404.html         # SPA fallback
â”œâ”€â”€ __tests__/           # Unit tests
â”œâ”€â”€ main.tsx             # App entry point
â”œâ”€â”€ Holidays.tsx         # Main app component
â””â”€â”€ consts.ts            # Global constants
```

### Key Files & Their Purposes

| File | Purpose |
|------|---------|
| `hooks/useCalendar.ts` | Core calendar logic: date calculations, filtering, event management |
| `utils/UTCDate.ts` | Consistent date handling across timezones (critical for reliability) |
| `utils/dateUtils.ts` | Date formatting, comparisons, and calendar calculations |
| `data/holidays/` | Holiday definitions per country (format: `{ date, name, localName, type, kind }`) |
| `src/assets/SW.ts` | Service Worker for push notifications (must be compiled separately) |
| `notifications/types.ts` | Message passing protocol between app and Service Worker |

## Development Guidelines

### Code Style & Patterns

#### Components
- Each component has its own directory with `.tsx` and `.module.css` file
- Use functional components with hooks
- Props should be typed via interfaces or types
- CSS Modules for scoped styling (no global CSS except `index.css`)
- Example structure:
  ```tsx
  interface ComponentProps {
    // ...types
  }
  
  export function Component({ prop }: ComponentProps) {
    return <div className={styles.root}>...</div>;
  }
  ```

#### Hooks
- Custom hooks go in `src/hooks/` and should be prefixed with `use`
- Use `useCallback` for event handlers to prevent unnecessary re-renders
- Document complex hooks with JSDoc comments

#### Date Handling
- **Always use `UTCDate` class** instead of native `Date` for consistency
- Dates are stored as `DateString` format: `"YYYY-M-D"` (variable month/day padding)
- Use `dateLocale` constant from `consts.ts` for formatting
- Timezone-aware operations via `Intl` API

#### Types
- Define types in dedicated `types/` directory or component folder
- Use `CountryCode` type from `data/countryNames.ts` for country references
- Export types that are used across multiple files
- Common types:
  - `CalendarDay` - single calendar cell data
  - `CalendarEvent` - union of `HolidayWithCountry | OtherEvent`
  - `HolidayDTO` - DTO for notifications

### TypeScript Strictness
- `strict: true` - maintain strict typing
- No unused variables or parameters
- No fallthrough switch cases
- Prefer type imports with `import type`

### Testing
- Test files live in `src/__tests__/` with `.test.ts` or `.test.tsx` extensions
- Use Jest + React Testing Library
- Test file naming: `ComponentName.test.tsx` or `utilFunction.test.ts`
- Run tests: `npm test`

## Common Development Tasks

### Adding a New Component
1. Create directory: `src/components/ComponentName/`
2. Create `ComponentName.tsx` with typed props interface
3. Create `ComponentName.module.css` for styles
4. Export from component index if used elsewhere
5. Add unit tests to `src/__tests__/`

### Adding Holiday Data for a New Country
1. Create file: `src/data/holidays/XX.ts` (where XX is ISO 3166-1 alpha-2 code)
2. Export array of holidays matching the `HolidayWithCountry` interface
3. Add country to `src/data/countryNames.ts`
4. Update `src/data/holidays/index.ts` to export the new data
5. Add flag emoji mapping in `src/utils/countryFlags.ts`

### Modifying Holiday Data Structure
- Holiday format: `{ date: "YYYY-M-D", name, localName, kind: "publicHoliday", type, country, countryCode }`
- `date` format is strict: use variable padding for month/day (no leading zeros on single digits)
- `kind` should always be `"publicHoliday"` for holidays
- `type` can be array of holiday categories or undefined

### Service Worker Development
1. Edit `src/assets/SW.ts`
2. Run: `npm run compile-sw` (TypeScript compilation)
3. Run: `npm run build-sw` (esbuild bundling to IIFE format)
4. The compiled `SW.js` is served from `src/assets/`
5. Message protocol uses constants from `notifications/types.ts`:
   - `startNotificationsCommand` - send events to monitor
   - `stopNotificationsCommand` - stop monitoring
   - `getNotificationsStatusCommand` - query status

### Running Commands
- `npm run dev` - Start dev server with HMR
- `npm run build` - Type check + build for production
- `npm run lint` - Check code style (max-warnings: 0)
- `npm test` - Run Jest tests
- `npm run build-sw` - Compile Service Worker
- `npm run preview` - Preview production build locally

## Design Patterns & Conventions

### State Management
- State lives in `useCalendar` hook
- URL hash parameters store view state (no cookies)
- URL format: `#countries=XX,YY&mode=month&date=YYYY-MM-DD`
- Use `URLSearchParams` to read/write state

### Event Flow
- Calendar clicks trigger event popups via `EventPopup` component
- Custom events can be added via `EventListInput` (stored locally or in state)
- Push notifications show holiday alerts for tomorrow

### Styling Conventions
- Use CSS Modules exclusively in components
- Global styles in `src/index.css` only for reset/base styles
- Responsive design: mobile-first approach
- Color scheme: Modern blue/white/gray palette
- Font: System fonts (no custom imports unless necessary)

## Important Constraints & Gotchas

### Critical Rules
1. **UTC Dates Only**: Always use `UTCDate` - native Date can cause timezone issues
2. **Service Worker Build**: Must run `npm run build-sw` after editing `SW.ts`
3. **String Date Format**: `"YYYY-M-D"` with variable padding (not ISO 8601)
4. **No Cookies**: All state via URL params - maintain this architecture
5. **Timezone Handling**: Use `dateLocale` from consts and Intl API for consistency
6. **CSS Modules**: Never import global CSS in components, use modules only
7. **Strict Mode**: TypeScript strict checking is enforced, no `any` types

### Common Pitfalls to Avoid
- âŒ Using native `Date` instead of `UTCDate` - causes timezone mismatches
- âŒ Forgetting to compile Service Worker after edits
- âŒ Date format mismatches (e.g., padding inconsistency)
- âŒ Styling with global CSS in components
- âŒ Missing type imports (use `import type` for types)
- âŒ Not updating URL state when calendar state changes
- âŒ Hardcoding country codes without `CountryCode` type

## Performance Considerations

- `useCalendar` uses `useMemo` for expensive calculations (filtering, sorting)
- Calendar grid renders large number of cells - optimize with proper key props
- Country filtering triggers recalculation - leverage memoization
- Service Worker checks events every 30 seconds (0.5 minute interval)
- Image assets: SVG data URIs in notification icons to avoid network requests

## Future Enhancement Areas

Based on `plans.md`:
- ğŸŒ **More countries**: Add holiday data in `src/data/holidays/`
- ğŸ“² **Push notifications**: Already implemented via Service Worker
- ğŸ¨ **Different templates**: Create variant components or CSS themes
- ğŸ” **Search functionality**: Extend `useCalendar` hook with search filter
- ğŸ—“ï¸ **Custom holidays**: Already supported, enhance UI with `EventListInput`

## Collaboration & Code Review Focus

When reviewing or writing code, prioritize:
1. **Type Safety**: Ensure all types are properly defined and imported
2. **Date Correctness**: Verify `UTCDate` usage and date format consistency
3. **Component Reusability**: Check for duplicated logic that could be abstracted
4. **Test Coverage**: New features should have corresponding tests
5. **CSS Scoping**: Verify all styles use CSS Modules
6. **Performance**: Check for unnecessary re-renders via excessive useState
7. **Accessibility**: Calendar grid should have proper ARIA labels

## Quick Reference: Type Imports

```typescript
// Date/Time
import { UTCDate, type DateString } from "../utils/UTCDate";

// Calendar types
import type { CalendarDay, CalendarEvent, HolidayWithCountry } from "../types";

// Countries
import type { CountryCode, CountryName } from "../data/countryNames";

// Notifications
import type { HolidayDTO } from "../notifications/types";

// Constants
import { dateLocale } from "../consts";
```

---

**Last Updated**: December 7, 2025
**Project Version**: 0.0.0
**Target Users**: React/TypeScript developers contributing to holiday calendar features

